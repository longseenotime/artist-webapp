<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= action === 'add' ? 'Add New' : 'Edit' %> Painting - Artist Studio</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body class="min-h-screen bg-stone-warm-50">
    <!-- Navigation -->
    <nav class="bg-white border-b border-stone-warm-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-sage-600 rounded-lg flex items-center justify-center">
                        <span class="text-white font-bold text-sm">A</span>
                    </div>
                    <span class="font-serif font-semibold text-xl text-stone-warm-900">
                        <%= action === 'add' ? 'Add New Painting' : 'Edit Painting' %>
                    </span>
                </div>
                
                <div class="flex items-center space-x-4">
                    <a href="/admin/dashboard" class="text-sage-600 hover:text-sage-700 transition-colors">
                        ‚Üê Back to Dashboard
                    </a>
                    <a href="/admin/logout" class="text-stone-warm-600 hover:text-stone-warm-700 transition-colors">Logout</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-white rounded-xl shadow-sm border border-stone-warm-100 p-8">
            <form method="POST" 
                  action="<%= action === 'add' ? '/admin/paintings' : `/admin/paintings/${painting.id}` %>" 
                  enctype="multipart/form-data" 
                  class="space-y-6">
                
                <!-- Image Upload -->
                <div>
                    <label class="block text-sm font-medium text-stone-warm-700 mb-4">
                        Painting Image
                    </label>
                    
                    <% if (painting && painting.image_url) { %>
                    <div class="mb-4">
                        <p class="text-sm text-stone-warm-600 mb-2">Current image:</p>
                        <img src="<%= painting.image_url %>" 
                             alt="Current painting" 
                             class="w-32 h-32 object-cover rounded-lg border border-stone-warm-200">
                        <input type="hidden" name="existing_image_url" value="<%= painting.image_url %>">
                    </div>
                    <% } %>
                    
                    <div class="border-2 border-dashed border-stone-warm-200 rounded-lg p-6 text-center hover:border-sage-400 transition-colors">
                        <input type="file" 
                               id="image" 
                               name="image" 
                               accept="image/*"
                               class="hidden"
                               onchange="previewImage(this)">
                        <label for="image" class="cursor-pointer">
                            <svg class="w-12 h-12 text-stone-warm-400 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                            </svg>
                            <p class="text-stone-warm-600">
                                <%= painting && painting.image_url ? 'Upload new image (optional)' : 'Click to upload image' %>
                            </p>
                            <p class="text-stone-warm-400 text-sm mt-1">PNG, JPG, GIF up to 5MB</p>
                        </label>
                    </div>
                    
                    <div id="imagePreview" class="hidden mt-4">
                        <p class="text-sm text-stone-warm-600 mb-2">New image preview:</p>
                        <img id="previewImg" class="w-32 h-32 object-cover rounded-lg border border-stone-warm-200">
                    </div>
                </div>

                <!-- Title -->
                <div>
                    <label for="title" class="block text-sm font-medium text-stone-warm-700 mb-2">
                        Title *
                    </label>
                    <input type="text" 
                           id="title" 
                           name="title" 
                           value="<%= painting ? painting.title : '' %>"
                           required
                           class="w-full px-4 py-3 border border-stone-warm-200 rounded-lg focus:ring-2 focus:ring-sage-500 focus:border-sage-500 transition-colors">
                </div>

                <!-- Description -->
                <div>
                    <label for="description" class="block text-sm font-medium text-stone-warm-700 mb-2">
                        Description
                    </label>
                    <textarea id="description" 
                              name="description" 
                              rows="4"
                              class="w-full px-4 py-3 border border-stone-warm-200 rounded-lg focus:ring-2 focus:ring-sage-500 focus:border-sage-500 transition-colors resize-none"><%= painting ? painting.description : '' %></textarea>
                </div>

                <!-- Medium and Year -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="medium" class="block text-sm font-medium text-stone-warm-700 mb-2">
                            Medium *
                        </label>
                        <input type="text" 
                               id="medium" 
                               name="medium" 
                               value="<%= painting ? painting.medium : '' %>"
                               placeholder="e.g., Oil on canvas"
                               required
                               class="w-full px-4 py-3 border border-stone-warm-200 rounded-lg focus:ring-2 focus:ring-sage-500 focus:border-sage-500 transition-colors">
                    </div>
                    
                    <div>
                        <label for="year" class="block text-sm font-medium text-stone-warm-700 mb-2">
                            Year *
                        </label>
                        <input type="number" 
                               id="year" 
                               name="year" 
                               value="<%= painting ? painting.year : new Date().getFullYear() %>"
                               min="1900"
                               max="<%= new Date().getFullYear() + 1 %>"
                               required
                               class="w-full px-4 py-3 border border-stone-warm-200 rounded-lg focus:ring-2 focus:ring-sage-500 focus:border-sage-500 transition-colors">
                    </div>
                </div>

                <!-- Category and Price -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="category" class="block text-sm font-medium text-stone-warm-700 mb-2">
                            Category *
                        </label>
                        <select id="category" 
                                name="category" 
                                required
                                class="w-full px-4 py-3 border border-stone-warm-200 rounded-lg focus:ring-2 focus:ring-sage-500 focus:border-sage-500 transition-colors">
                            <option value="paintings" <%= painting && painting.category === 'paintings' ? 'selected' : '' %>>Paintings</option>
                            <option value="digital" <%= painting && painting.category === 'digital' ? 'selected' : '' %>>Digital Art</option>
                            <option value="sculptures" <%= painting && painting.category === 'sculptures' ? 'selected' : '' %>>Sculptures</option>
                        </select>
                    </div>
                    
                    <div>
                        <label for="price" class="block text-sm font-medium text-stone-warm-700 mb-2">
                            Price ($) *
                        </label>
                        <input type="number" 
                               id="price" 
                               name="price" 
                               value="<%= painting ? painting.price : '' %>"
                               step="0.01"
                               min="0"
                               required
                               class="w-full px-4 py-3 border border-stone-warm-200 rounded-lg focus:ring-2 focus:ring-sage-500 focus:border-sage-500 transition-colors">
                    </div>
                </div>

                <!-- Dimensions and Availability -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="dimensions" class="block text-sm font-medium text-stone-warm-700 mb-2">
                            Dimensions
                        </label>
                        <input type="text" 
                               id="dimensions" 
                               name="dimensions" 
                               value="<%= painting ? painting.dimensions : '' %>"
                               placeholder="e.g., 24\" x 36\""
                               class="w-full px-4 py-3 border border-stone-warm-200 rounded-lg focus:ring-2 focus:ring-sage-500 focus:border-sage-500 transition-colors">
                    </div>
                    
                    <div>
                        <label for="availability" class="block text-sm font-medium text-stone-warm-700 mb-2">
                            Availability *
                        </label>
                        <select id="availability" 
                                name="availability" 
                                required
                                class="w-full px-4 py-3 border border-stone-warm-200 rounded-lg focus:ring-2 focus:ring-sage-500 focus:border-sage-500 transition-colors">
                            <option value="available" <%= painting && painting.availability === 'available' ? 'selected' : '' %>>Available</option>
                            <option value="sold" <%= painting && painting.availability === 'sold' ? 'selected' : '' %>>Sold</option>
                            <option value="commission" <%= painting && painting.availability === 'commission' ? 'selected' : '' %>>Commission Only</option>
                        </select>
                    </div>
                </div>

                <!-- Featured -->
                <div>
                    <label class="flex items-center space-x-3">
                        <input type="checkbox" 
                               id="featured" 
                               name="featured" 
                               <%= painting && painting.featured ? 'checked' : '' %>
                               class="w-5 h-5 text-sage-600 border-stone-warm-300 rounded focus:ring-sage-500">
                        <span class="text-sm font-medium text-stone-warm-700">
                            Feature this painting on the homepage
                        </span>
                    </label>
                </div>

                <!-- Submit Buttons -->
                <div class="flex justify-end space-x-4 pt-6 border-t border-stone-warm-100">
                    <a href="/admin/dashboard" 
                       class="btn-secondary">
                        Cancel
                    </a>
                    <button type="submit" 
                            class="btn-primary">
                        <%= action === 'add' ? 'Add Painting' : 'Update Painting' %>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        function previewImage(input) {
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                const preview = document.getElementById('imagePreview');
                const previewImg = document.getElementById('previewImg');
                
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }
    </script>
</body>
</html>